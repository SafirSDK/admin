<html>
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <meta charset="utf-8">
</head>
<body>
<table style="text-align: left;" cellpadding="0" cellspacing="0" width="100%" height="100%">
  <tbody>
    <tr>
      <td align="center" valign="center">

        <table style="text-align: left;" cellpadding="2" cellspacing="2">
          <tbody>
            <tr align="center">
              <td style="vertical-align: top;"><br>
              </td>
              <th style="vertical-align: top; text-align: center;">Success and Failures<br>
              </th>
              <th style="vertical-align: top; text-align: center;">Failures<br>
              </th>
            </tr>
            <tr align="center">
              <th style="vertical-align: middle;">Standalone<br>
                Test<br>
              </th>
              <td style="vertical-align: top;">
                <img id="standalone_test_img" alt="Standalone Test Status" src="https://projekt.consoden.se/safir/job/Standalone%20Test/test/trend?width=450&amp;height=300" width="450" height="300" >
              </td>
              <td style="vertical-align: top;">
                <img id="standalone_test_fail_img" alt="Standalone Test Status" src="https://projekt.consoden.se/safir/job/Standalone%20Test/test/trend?width=450&amp;height=300&amp;failureOnly=true" width="450" height="300">
              </td>
            </tr>
            <tr align="center">
              <th style="vertical-align: middle;">Multinode<br>Test</th>
              <td style="vertical-align: top;">
                <img id="multinode_test_img" alt="Standalone Test Status" src="https://projekt.consoden.se/safir/job/Multinode%20Test/test/trend?width=450&amp;height=300" width="450" height="300">
              </td>
              <td style="vertical-align: top;">
                <img id="multinode_test_fail_img" alt="Standalone Test Status" src="https://projekt.consoden.se/safir/job/Multinode%20Test/test/trend?width=450&amp;height=300&amp;failureOnly=true" width="450" height="300">
              </td>
            </tr>
          </tbody>
        </table>

      </td>
    </tr>
    <tr>
      <td width="100%" align="center" valign="center">

        <table style="text-align: left;" cellpadding="2" cellspacing="2" width="100%" height="100%">
          <tbody>
            <tr>
              <td height="100%">&nbsp;</td>
            </tr>
            <tr align="center" valign="center">
              <td height="174">
                <img src="https://btcticker.appspot.com/images/bitcoin.png" width="175" height="174"/>
              </td>
              <td>
                <span id="btc_data" style="display: none;">
                  <table height="100%">
                    <tbody>
                      <tr>
                        <td align="center" colspan="7" height="100">
                          <span style="font-size:90px;" id="btc_last_price">Failed to load</span>
                        </td>
                      </tr>
                      <tr>
                        <td width="5%">&nbsp;</td>
                        <td nowrap><span style="font-size:20px; vertical-align: top;">Ask:&nbsp;</span></td>
                        <td nowrap align="right"><span style="font-size:20px; vertical-align: top;" id="btc_ask_price">Failed to load</span></td>
                        <td nowrap><span style="font-size:20px; vertical-align: top;">&nbsp;&nbsp;&nbsp;Bid:</span></td>
                        <td nowrap align="right"><span style="font-size:20px; vertical-align: top;" id="btc_bid_price">Failed to load</span></td>
                        <td>&nbsp;</td>
                        <td width="5%">&nbsp;</td>
                      </tr>
                      <tr>
                        <td width="5%">&nbsp;</td>
                        <td nowrap><span style="font-size:20px; vertical-align: top;">24h average:&nbsp;</span></td>
                        <td nowrap align="right"><span style="font-size:20px; vertical-align: top;" id="btc_24h_price">Failed to load</span></td>
                        <td nowrap><span style="font-size:20px; vertical-align: top;">&nbsp;&nbsp;&nbsp;24h volume:</span></td>
                        <td nowrap align="right"><span style="font-size:20px; vertical-align: top;" id="btc_vol">Failed to load</span></td>
                        <td nowrap align="left"><span style="font-size:20px; vertical-align: top;">&nbsp;BTC</span></td>
                        <td width="5%">&nbsp;</td>
                      </tr>
                    </tbody>
                  </table>
                </span>
              </td>
              <td>
                <img src="https://btcticker.appspot.com/images/bitcoin.png" width="175" height="174"/>
              </td>
            </tr>
            <tr>
              <td height="100%">&nbsp;</td>
            </tr>
          </tbody>
        </table>

      </td>
    </tr>
    <tr>
      <td width="100%" align="center" valign="center">
        <table style="text-align: left; background-color: #EEEEEE;" cellpadding="2" cellspacing="2" width="100%" height="100%">
          <tbody>
            <tr>
              <td width="20%" align="right" valign="center">
                <span style="font-size:24px; font-family: Courier;">Stockholm:&nbsp;</span><br>
                <span style="font-size:24px; font-family: Courier;">UTC:&nbsp;</span>
              </td>
              <td width="55%" align="left" valign="center">
                <span style="font-size:24px; font-family: Courier;" id="rt_datetime_local"></span><br>
                <span style="font-size:24px; font-family: Courier;" id="rt_datetime_utc"></span>
              </td>
              <td width="25%" align="center" valign="center">
                <span style="font-size:56px; font-family: Courier;"><span id="rt_clock_local" style="font-family: Courier;"></span></span>
              </td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>    
  </tbody>
</table>
<br>
<br>

<script>
  $(document).ready(function(){
    refreshRealtimeClock();
    refreshBitcoin();
    setInterval(refreshBitcoin, 120000); // 2 minutes
    setInterval(refreshTestTrends, 900000); // 15 minutes
    setInterval(refreshRealtimeClock, 15000); // 15 second
  }); 

  function refreshBitcoin() { 
    $.getJSON( "https://api.bitcoinaverage.com/ticker/USD", function( json ) {
      var last = json["last"].toFixed(2);
      var ask = json["ask"].toFixed(2);
      var bid = json["bid"].toFixed(2);
      var a24h = json["24h_avg"].toFixed(2);
      var vol = json["total_vol"].toFixed(2);

      if (last >= a24h) {
        // Up trend
        $("#btc_last_price").css("color", "blue");
      } else {
        $("#btc_last_price").css("color", "red");
      }

      document.getElementById("btc_last_price").innerHTML="$ " + last;
      document.getElementById("btc_ask_price").innerHTML="$ " + ask;
      document.getElementById("btc_bid_price").innerHTML="$ " + bid;
      document.getElementById("btc_24h_price").innerHTML="$ " + a24h;
      document.getElementById("btc_vol").innerHTML="" + vol;
      $("#btc_data").show();
    });
  }

  function refreshTestTrends() { 
    // trick to force picture refresh
    var x = new Date();
    var xtime =  x.getTime();

    $("#standalone_test_img").attr("src", "https://projekt.consoden.se/safir/job/Standalone%20Test/test/trend?width=450&height=300&dummy=" + xtime);
    $("#standalone_test_fail_img").attr("src", "https://projekt.consoden.se/safir/job/Standalone%20Test/test/trend?width=450&height=300&failureOnly=true&dummy=" + xtime);
    $("#multinode_test_img").attr("src", "https://projekt.consoden.se/safir/job/Multinode%20Test/test/trend?width=450&height=300&dummy=" + xtime);
    $("#multinode_test_fail_img").attr("src", "https://projekt.consoden.se/safir/job/Multinode%20Test/test/trend?width=450&height=300&failureOnly=true&dummy=" + xtime);

  }

  function refreshRealtimeClock() {

    var x = new Date();
    var utc_date = new Date();
    utc_date.setHours(utc_date.getHours() + (utc_date.getTimezoneOffset()/60));

    document.getElementById('rt_datetime_local').innerHTML = x.toLocaleFormat("%Y-%m-%d %H:%M %Z (%a w%W)");
    document.getElementById('rt_datetime_utc').innerHTML = utc_date.toLocaleFormat("%Y-%m-%d %H:%M");
    document.getElementById('rt_clock_local').innerHTML = x.toLocaleFormat("%H:%M");

  }

</script>
</body>
</html>

